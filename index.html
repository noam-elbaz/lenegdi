<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Negdi Tamid - Audio Classes</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>L'Negdi Tamid</h1>
                <span class="subtitle">Audio Classes</span>
            </div>
            <nav class="nav">
                <button id="adminBtn" class="admin-btn">Admin Panel</button>
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search classes..." class="search-input">
                    <button id="searchBtn" class="search-btn">üîç</button>
                </div>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="filters">
                <h3>Filter by Tags:</h3>
                <div id="tagFilters" class="tag-filters"></div>
                <button id="clearFilters" class="clear-filters">Clear All</button>
            </div>
            
            <div class="classes-grid" id="classesGrid">
                <!-- Audio classes will be dynamically loaded here -->
            </div>
        </div>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Admin Login</h2>
                <span class="close-login">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm" class="upload-form">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="submit-btn">Login</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Enhanced Admin Panel Modal -->
    <div id="adminModal" class="modal admin-modal">
        <div class="admin-modal-content">
            <div class="admin-header">
                <h2>L'Negdi Tamid - Admin Panel</h2>
                <div class="admin-header-controls">
                    <button id="toggleFullscreen" class="control-btn">‚õ∂ Fullscreen</button>
                    <button id="logoutBtn" class="control-btn logout">Logout</button>
                    <span class="close admin-close">&times;</span>
                </div>
            </div>
            
            <div class="admin-tabs">
                <button class="tab-btn active" data-tab="upload">üì§ Upload New Class</button>
                <button class="tab-btn" data-tab="manage">üìÇ Manage Classes</button>
                <button class="tab-btn" data-tab="analytics">üìä Analytics</button>
            </div>

            <div class="admin-content">
                <!-- Upload Tab -->
                <div id="uploadTab" class="tab-content active">
                    <div class="upload-section">
                        <h3>Upload New Audio Class</h3>
                        <form id="uploadForm" class="enhanced-upload-form">
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="audioFile">Audio File</label>
                                    <div class="file-upload-area" id="fileUploadArea">
                                        <input type="file" id="audioFile" accept="audio/*" required>
                                        <div class="upload-placeholder">
                                            <div class="upload-icon">üéµ</div>
                                            <p>Drag and drop your audio file here, or click to browse</p>
                                            <p class="upload-hint">Supported: MP3, WAV, OGG, M4A, AAC, FLAC (Max 50MB)</p>
                                        </div>
                                        <div class="file-preview hidden" id="filePreview">
                                            <div class="file-info">
                                                <span class="file-name"></span>
                                                <span class="file-size"></span>
                                                <span class="file-duration"></span>
                                            </div>
                                            <button type="button" class="remove-file" id="removeFile">Remove</button>
                                        </div>
                                    </div>
                                    <div class="upload-progress hidden" id="uploadProgress">
                                        <div class="progress-bar">
                                            <div class="progress-fill"></div>
                                        </div>
                                        <span class="progress-text">0%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="classTitle">Title *</label>
                                    <input type="text" id="classTitle" required placeholder="Enter class title">
                                </div>
                                <div class="form-group">
                                    <label for="classCategory">Category</label>
                                    <select id="classCategory">
                                        <option value="">Select category</option>
                                        <option value="Torah">Torah</option>
                                        <option value="Halacha">Halacha</option>
                                        <option value="Philosophy">Philosophy</option>
                                        <option value="Chassidus">Chassidus</option>
                                        <option value="Parsha">Parsha</option>
                                        <option value="Holidays">Holidays</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="classDescription">Description</label>
                                    <textarea id="classDescription" rows="4" placeholder="Enter class description..."></textarea>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="classTags">Tags</label>
                                    <input type="text" id="classTags" placeholder="e.g., Torah, Halacha, Philosophy">
                                    <div class="tags-preview" id="tagsPreview"></div>
                                </div>
                                <div class="form-group">
                                    <label for="classLevel">Level</label>
                                    <select id="classLevel">
                                        <option value="">Select level</option>
                                        <option value="Beginner">Beginner</option>
                                        <option value="Intermediate">Intermediate</option>
                                        <option value="Advanced">Advanced</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn secondary" id="resetForm">Reset Form</button>
                                <button type="submit" class="btn primary" id="submitUpload">
                                    <span class="btn-text">Upload Class</span>
                                    <span class="btn-spinner hidden">‚ü≥</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Manage Tab -->
                <div id="manageTab" class="tab-content">
                    <div class="manage-section">
                        <div class="manage-header">
                            <h3>Manage Audio Classes</h3>
                            <div class="manage-controls">
                                <div class="search-filter">
                                    <input type="text" id="adminSearch" placeholder="Search classes..." class="admin-search">
                                    <select id="adminFilter" class="admin-filter">
                                        <option value="">All Categories</option>
                                        <option value="Torah">Torah</option>
                                        <option value="Halacha">Halacha</option>
                                        <option value="Philosophy">Philosophy</option>
                                        <option value="Chassidus">Chassidus</option>
                                        <option value="Parsha">Parsha</option>
                                        <option value="Holidays">Holidays</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="bulk-actions">
                                    <button class="btn secondary" id="selectAll">Select All</button>
                                    <button class="btn danger" id="deleteSelected" disabled>Delete Selected</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="classes-table-container">
                            <table class="classes-table" id="classesTable">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="selectAllCheckbox"></th>
                                        <th>Title</th>
                                        <th>Category</th>
                                        <th>Duration</th>
                                        <th>Size</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="classesTableBody">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="table-pagination" id="tablePagination">
                            <button class="btn secondary" id="prevPage" disabled>Previous</button>
                            <span class="page-info" id="pageInfo">Page 1 of 1</span>
                            <button class="btn secondary" id="nextPage" disabled>Next</button>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="analyticsTab" class="tab-content">
                    <div class="analytics-section">
                        <h3>Analytics & Statistics</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalClasses">0</div>
                                <div class="stat-label">Total Classes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalDuration">0h 0m</div>
                                <div class="stat-label">Total Duration</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalSize">0 MB</div>
                                <div class="stat-label">Total Storage</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="avgDuration">0m</div>
                                <div class="stat-label">Avg Duration</div>
                            </div>
                        </div>
                        
                        <div class="charts-container">
                            <div class="chart-card">
                                <h4>Classes by Category</h4>
                                <div class="category-chart" id="categoryChart"></div>
                            </div>
                            <div class="chart-card">
                                <h4>Recent Uploads</h4>
                                <div class="recent-uploads" id="recentUploads"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Class Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content edit-modal-content">
            <div class="modal-header">
                <h3>Edit Audio Class</h3>
                <span class="close" id="closeEditModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editForm" class="edit-form">
                    <input type="hidden" id="editClassId">
                    <div class="form-group">
                        <label for="editTitle">Title *</label>
                        <input type="text" id="editTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="editDescription">Description</label>
                        <textarea id="editDescription" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editTags">Tags</label>
                        <input type="text" id="editTags">
                        <div class="tags-preview" id="editTagsPreview"></div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn secondary" id="cancelEdit">Cancel</button>
                        <button type="submit" class="btn primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Sticky Audio Player -->
    <div id="audioPlayer" class="audio-player hidden">
        <div class="player-content">
            <div class="track-info">
                <div class="track-title" id="currentTitle">No track selected</div>
                <div class="track-description" id="currentDescription"></div>
            </div>
            <div class="player-controls">
                <button id="prevBtn" class="control-btn">‚èÆ</button>
                <button id="playPauseBtn" class="control-btn play-pause">‚ñ∂</button>
                <button id="nextBtn" class="control-btn">‚è≠</button>
            </div>
            <div class="progress-container">
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <div class="progress-bar">
                        <div id="progressBar" class="progress"></div>
                        <input type="range" id="progressSlider" min="0" max="100" value="0" class="progress-slider">
                    </div>
                    <span id="duration">0:00</span>
                </div>
            </div>
            <div class="volume-controls">
                <button id="muteBtn" class="control-btn">üîä</button>
                <input type="range" id="volumeSlider" min="0" max="100" value="100" class="volume-slider">
            </div>
            <button id="closePlayer" class="close-player">‚úï</button>
        </div>
        <audio id="audioElement" preload="metadata"></audio>
    </div>

    <script src="supabase-config.js"></script>
    <script src="script.js"></script>
</body>
</html>